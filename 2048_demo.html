<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<!--<script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script>-->
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
		<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
		<title></title>
		<style type="text/css">
			.backGroud {
				background-color: darkgrey;
				position: absolute;
				height: 82vw;
				width: 82%;
				left: 10%;
				top: 30vw;
				border-radius: 2vw;
			}
			
			.backGroudCopy {
				background-color: grey;
				position: relative;
				height: 200px;
				width: 200px;
				margin-left: 250px;
				margin-top: 250px;
				border-radius: 10px;
			}
			
			.tableRow {
				position: absolute;
				height: 18vw;
				width: 100%;
				background-color: darkgrey;
				/*margin-top: 2vw;*/
				/*margin-bottom: 2vw;*/
			}
			
			.grid {
				position: absolute;
				background-color: lightgrey;
				border-radius: 2vw;
				width: 18vw;
				height: 18vw;
			}
			
			.diamond {
				position: absolute;
				height: 18vw;
				width: 18vw;
				border-radius: 2vw;
				color: grey;
				font-size: 500%;
				text-align: center;
				line-height: 18vw;
			}
			
			.back {
				position: absolute;
				height: 4vw;
				width: 18vw;
				top: 25vw;
				left: 10%;
				background-color: goldenrod;
				font-size: 100%;
				text-align: center;
				line-height: 4vw;
			}
			
			.winCircle {
				position: absolute;
				height: 36vw;
				width: 36vw;
				border-radius: 18vw;
				background-color: red;
			}
		</style>
	</head>

	<body id="body" style="height: 100%">
		<div data-role="page" id="page" style="height: 100%">
			<div data-role='content' id="content" style="height:100%">
				<div id="table" class="backGroud">
					<script type="text/javascript">
						var gridMargin = 0;
						var initTable = function() {
							console.log("初始化table")
							for(var i = 0; i < 4; i++) {
								var createTrString = $("<div>").attr("id", "tr" + i);
								$("#table").append(createTrString);
								$("#tr" + i).attr("class", "tableRow");
								var topValue = i * ($(".tableRow").height() * 1.1) + $(".tableRow").height() * 0.1;
								$("#tr" + i).offset({
									top: topValue
								});
								for(var j = 0; j < 4; j++) {
									var createTdString = $("<div>").attr("id", "td" + i + j);
									$("#tr" + i).append(createTdString);
									$("#td" + i + j).attr("class", "grid");
									var leftValue = j * $(".grid").height() * 1.1 + $(".grid").height() * 0.1;
									$("#td" + i + j).offset({
										left: leftValue
									});
								}
							}
						};
						$(document).on("pagecreate", function() {
							initTable();
							setTimeout(function() {
								initRound();
								initRound();
							}, 0);
						});
					</script>
				</div>
				<div id="back" class="back">
					后退一步
					<script type="text/javascript">
						$("#back").click(function() {
							//取出数据
							diamondList = lastData();
							//清除界面
							clearUI();
							//生成
							generateDiamondFromList(diamondList);
						});
					</script>
				</div>
			</div>

			<script>
				var beginX, beginY, endX, endY, swipeLeft, swipeRight, swipeUp, swipeDown, range = 30;
				var haveIdentified = false;
				var page = 0;

				if(typeof SwipeDirection == "undefined") {
					var SwipeDirection = {
						SwipeLeft: 0,
						SwipeRight: 1,
						SwipeUp: 2,
						SwipeDown: 3
					}
				}
				var complete = true;

				function debugClick(dirction) {
					//返回功能之记录当前数据
					if(complete) {
						complete = false;
						record(diamondList);
						moveDiamonds(dirction, diamondList, function(isMoved) {
							console.log("回调执行");
							setTimeout(function() {
								//检查是否成功出现2048
								var ifWin = checkIfWin(diamondList);
								if(ifWin) {
									alert("你赢啦");
								} else {
									if(isMoved) {
										initRound();
									}
								}
								complete = true;
							}, 0);
						});
						//					test();
						console.log(event.type);
					}
				}

				function refreshCopyTable() {
					//先清空
					var count = 0;
					$("div[id^='copydiamond']").each(function() {
						$(this).remove();
						count++;
					});
					console.log("查找到 " + count + "个对象");
					//然后生成
					for(var i in diamondList) {
						var diamond = diamondList[i];
						generateCopyDiv(diamond);
					}
				}

				document.getElementById("page").addEventListener('touchstart', function(event) {
					event.stopPropagation();
					//event.preventDefault();
					beginX = event.targetTouches[0].screenX;
					beginY = event.targetTouches[0].screenY;
					swipeLeft = false, swipeRight = false;
					swipeDown = false, swipeUp = false;
					haveIdentified = false;
				});

				document.getElementById("page").addEventListener('touchmove', function(event) {
					event.stopPropagation();
					event.preventDefault();
					if(!haveIdentified) {
						endX = event.targetTouches[0].screenX;
						endY = event.targetTouches[0].screenY;
						// 左右滑动
						if(Math.abs(endX - beginX) - Math.abs(endY - beginY) > 0) {
							/*向右滑动*/
							if(endX - beginX > range) {
								swipeRight = true;
								swipeLeft = false;
								haveIdentified = true;
								debugClick(SwipeDirection.SwipeRight);
							} else if(beginX - endX > range) {
								/*向左滑动*/
								swipeLeft = true;
								swipeRight = false;
								haveIdentified = true;
								debugClick(SwipeDirection.SwipeLeft);
							}
						} else if(Math.abs(endX - beginX) - Math.abs(endY - beginY) < 0) {
							// 上下滑动
							if(endY - beginY > range) {
								swipeDown = true;
								swipeUp = false;
								haveIdentified = true;
								debugClick(SwipeDirection.SwipeDown);
							} else if(beginY - endY > range) {
								swipeUp = true;
								swipeDown = false;
								haveIdentified = true;
								debugClick(SwipeDirection.SwipeUp);
							}
						}
					}

				});
				document.getElementById("page").addEventListener('touchend', function(event) {
					event.stopPropagation();
					//event.preventDefault();
				});

				function eventFunction(stirng) {
					alert(stirng);
				}

				function checkIfWin(diamondListParam) {
					for(var key in diamondListParam) {
						var diamond = diamondListParam[key];
						if(parseInt(diamond.value) >= 2048) {
							//赢了
							return true;
						}
					}
					return false;
				}

				var diamondListHistory = new Array;

				function record(diamondListParam) {
					var newDiamondList = new Array;
					//要生成许多diamond，防止后面diamond改变
					for(var key in diamondListParam) {
						var diamond = diamondListParam[key];
						var newDiamond = copyDiamondFrom(diamond);
						newDiamondList[key] = newDiamond;
					}
					diamondListHistory.push(newDiamondList);
				}

				function copyDiamondFrom(diamond) {
					var newDiamond = new Diamond(diamond.row, diamond.colunm, diamond.value);
					return newDiamond;
				}

				function lastData() {
					return diamondListHistory.pop();
				}

				function clearUI() {
					//清空
					var count = 0;
					$("div[id^='diamond']").each(function() {
						$(this).remove();
						count++;
					});
					console.log("查找到 " + count + "个对象");
				}

				function generateDiamondFromList(diamondListParam) {
					for(var i in diamondListParam) {
						var diamond = diamondListParam[i];
						generateDiv(diamond);
					}
				}

				var diamondList = new Array(4);
				var baseColor = 10;

				//初始化格局
				function initRound() {
					//先随机生成位置
					var fristGridRow = GetRandomNum(0, 3);
					var fristGridColumn = GetRandomNum(0, 3);
					var valueOfGrid = GetRandomNum(1, 2);
					valueOfGrid *= 2;
					var diamond = new Diamond(fristGridRow, fristGridColumn, valueOfGrid);

					//然后检查位置是否被占用
					//如被占用则顺序找出未被占用的位置
					var row = diamond.row;
					var colunm = diamond.colunm;
					var isConflict = isExistAt(row, colunm, diamondList);
					var haveFind = true;
					if(isConflict) {
						haveFind = false;
						for(var i = 0; i < 4; i++) {
							for(var j = 0; j < 4; j++) {
								isConflict = isExistAt(i, j, diamondList);
								if(!isConflict) {
									haveFind = true;
									colunm = j;
									break;
								}
							}
							if(haveFind) {
								row = i;
								break;
							}
						}
					}

					if(haveFind) {
						diamond.row = row;
						diamond.colunm = colunm;
						generateDiv(diamond);
						diamondList[row.toString() + colunm.toString()] = diamond;
					} else {
						console.log("图表已满，找不到空位");
					}

				}

				function isExistAt(row, colunm, inDiamondList) {
					var diamond = inDiamondList[row.toString() + colunm.toString()];
					if(!diamond) {
						return false;
					} else {
						return true;
					}
				}

				function generateDiv(diamondPara) {
					var diamondID = "diamond" + diamondPara.row + diamondPara.colunm;
					console.log("生成方块UI" + diamondID);
					var createDiaObject = $("<div>").attr("id", diamondID);
					$("#page").append(createDiaObject);
					$("#" + diamondID).attr("class", "diamond");
					var topValue = $("#td" + diamondPara.row + diamondPara.colunm).offset().top;
					var leftValue = $("#td" + diamondPara.row + diamondPara.colunm).offset().left;
					$("#" + diamondID).offset({
						top: topValue,
						left: leftValue
					});
					$("#" + diamondID).css("background-color", diamondPara.color(diamondPara.value));
					$("#" + diamondID).text(diamondPara.value);
					flash("#" + diamondID, 3, 10, 50);
					console.log("生成方块" + diamondPara.row + diamondPara.colunm);
				}

				function generateCopyDiv(diamondPara) {
					var diamondID = "copydiamond" + diamondPara.row + diamondPara.colunm;
					console.log("生成方块UI" + diamondID);
					var createDiaObject = $("<div>").attr("id", diamondID);
					$("#page").append(createDiaObject);
					$("#" + diamondID).attr("class", "diamond");
					var topValue = diamondPara.row * 50 + $("#tableCopy").offset().top;
					var leftValue = diamondPara.colunm * 50 + $("#tableCopy").offset().left;
					$("#" + diamondID).offset({
						top: topValue,
						left: leftValue
					});
					$("#" + diamondID).css("background-color", diamondPara.color(diamondPara.value));
					$("#" + diamondID).text(diamondPara.value);
					console.log("生成方块" + diamondPara.row + diamondPara.colunm);
				}

				function GetRandomNum(Min, Max) {
					var Range = Max - Min;
					var Rand = Math.random();
					return(Min + Math.round(Rand * Range));
				}

				//可移动的方格对象
				function Diamond(row, colunm, value) {
					this.row = row;
					this.colunm = colunm;
					this.value = value;
					this.lastRow;
					this.lastColunm;
					this.lastValue;
					this.mergeTo = false; //被并入下一个格子
					this.color = function(value) {
						var result;
						switch(value) {
							case 2:
								{
									result = "#fdffdf";
								}
								break;
							case 4:
								{
									result = "#f3d7b5";
								}
								break;
							case 8:
								{
									result = "#efcee8";
								}
								break;
							case 16:
								{
									result = "#daf9ca";
								}
								break;
							case 32:
								{
									result = "#c7b3e5";
								}
								break;
							case 64:
								{
									result = "#ffebcc";
								}
								break;
							case 128:
								{
									result = "#ffb86c";
								}
								break;
							case 256:
								{
									result = "#f01b2d";
								}
								break;
							case 512:
								{
									result = "#869b74";
								}
								break;
							case 1024:
								{
									result = "#ff5983";
								}
								break;
							case 2048:
								{
									result = "#c1194e";
								}
								break;
							default:
								{
									result = "#000000";
								}
								break;
						}
						return result;
					}
					this.id = function(diamond) {
						return "diamond" + diamond.row + diamond.colunm;
					}
					this.merged = false; //有格子并入
				}

				$.fn.getHexBackgroundColor = function(rgb) {
					if($.browser.msie && $.browser.version > 8 || $.browser.mozilla || $.browser.webkit) {
						rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);

						function hex(x) {
							return("0" + parseInt(x).toString(16)).slice(-2);
						}
						rgb = "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
					}
					return rgb;
				}

				var diamondListLocal;
				var diamondTempList; //用于存储中间被并入其他方块的方块

				function moveDiamonds(dirction, diamondListPara, callback) {
					diamondListLocal = diamondListPara;
					diamondTempList = new Array;

					console.log(diamondListLocal);

					for(var i in diamondListLocal) {
						var diamond = diamondListLocal[i];
						diamond.lastRow = diamond.row;
						diamond.lastColunm = diamond.colunm;
						diamond.lastValue = diamond.value;
						diamond.mergeTo = false;
						diamond.merged = false;
					}

					//遍历现在的方块，往滑动方向移动
					var isMoved = false;
					var continueMove = true;
					while(continueMove) {
						continueMove = false;
						switch(dirction) {
							case SwipeDirection.SwipeLeft:
								{
									for(var j = 0; j < 4; j++) {
										for(var i = 0; i < 4; i++) {
											var haveHandle = moveOrMergeHandle(i, j, dirction);
											if(haveHandle) {
												continueMove = true;
											}
										}
									}
								}
								break;
							case SwipeDirection.SwipeRight:
								{
									for(var j = 3; j >= 0; j--) {
										for(var i = 0; i < 4; i++) {
											var haveHandle = moveOrMergeHandle(i, j, dirction);
											if(haveHandle) {
												continueMove = true;
											}
										}
									}
								}
								break;
							case SwipeDirection.SwipeDown:
								{
									for(var i = 3; i >= 0; i--) {
										for(var j = 0; j < 4; j++) {
											var haveHandle = moveOrMergeHandle(i, j, dirction);
											if(haveHandle) {
												continueMove = true;
											}
										}
									}
								}
								break;
							case SwipeDirection.SwipeUp:
								{
									for(var i = 0; i < 4; i++) {
										for(var j = 0; j < 4; j++) {
											var haveHandle = moveOrMergeHandle(i, j, dirction);
											if(haveHandle) {
												continueMove = true;
											}
										}
									}
								}
								break;
						}
						if(continueMove) {
							isMoved = true;
						}
					}

					refreshDataToUI(diamondListLocal, diamondTempList, dirction, callback, isMoved);
				}

				function refreshDataToUI(diamondListParam, diamondTempListParam, dirction, callback, isMoved) {
					var length = countDiamondList(diamondListParam);
					length += countDiamondList(diamondTempListParam);
					if(length > 0) {
						function checkExistAndRefreshColor(i, j) {
							var diamondTemp = getDiamondWithOldPosition(i, j, diamondTempListParam);
							var isDiamondTempExist = isExistAtWithOldPosition(i, j, diamondTempListParam);
							if(isDiamondTempExist) {
								uiColorRefresh(diamondTemp);
							}

							var diamond = getDiamondWithOldPosition(i, j, diamondListLocal);
							var isDiamondExist = isExistAtWithOldPosition(i, j, diamondListLocal);
							if(isDiamondExist) {
								uiColorRefresh(diamond);
							}
						}
						var count = 0;

						function checkIfMoveComplete() {
							if(count == length) {
								//更新颜色和text
								switch(dirction) {
									case SwipeDirection.SwipeLeft:
										{
											for(var j = 0; j < 4; j++) {
												for(var i = 0; i < 4; i++) {
													checkExistAndRefreshColor(i, j);
												}
											}
										}
										break;
									case SwipeDirection.SwipeRight:
										{
											for(var j = 3; j >= 0; j--) {
												for(var i = 0; i < 4; i++) {
													checkExistAndRefreshColor(i, j);
												}
											}
										}
										break;
									case SwipeDirection.SwipeDown:
										{
											for(var i = 3; i >= 0; i--) {
												for(var j = 0; j < 4; j++) {
													checkExistAndRefreshColor(i, j);
												}
											}
										}
										break;
									case SwipeDirection.SwipeUp:
										{
											for(var i = 0; i < 4; i++) {
												for(var j = 0; j < 4; j++) {
													checkExistAndRefreshColor(i, j);
												}
											}
										}
										break;
								}

								callback(isMoved);
							}
						}
						for(var key in diamondListParam) {
							var diamond = diamondListParam[key];
							uiMove(diamond, function() {
								count++;
								checkIfMoveComplete();
							});
						}
						for(var key in diamondTempListParam) {
							var diamond = diamondTempListParam[key];
							uiMove(diamond, function() {
								count++;
								checkIfMoveComplete();
							});
						}

					} else {
						callback(isMoved);
					}
				}

				function countDiamondList(diamondListParam) {
					var count = 0;
					for(var i in diamondListParam) {
						count++;
					}
					return count;
				}

				function moveOrMergeHandle(i, j, dirction) {
					var isExistOfCurrent = isExistAt(i, j, diamondListLocal);
					if(isExistOfCurrent) {
						var diamond = getDiamond(i, j, diamondListLocal);
						if(!diamond.mergeTo) {
							if(diamond.row != i || diamond.colunm != j) {
								console.log(i + " " + j + "位置中的数据错误1");
							}
							var resultArray = tempDiamond(dirction, diamond);
							var tempMoveSuccess = resultArray[0];
							if(tempMoveSuccess) {
								var diamondTemp = resultArray[1];
								var isExist = isExistAt(diamondTemp.row, diamondTemp.colunm, diamondListLocal);
								if(isExist) {
									if(diamond.row != i || diamond.colunm != j) {
										console.log(i + " " + j + "位置中的数据错误2");
									}
									var nextDiamond = getDiamond(diamondTemp.row, diamondTemp.colunm, diamondListLocal);
									if(nextDiamond.mergeTo == false) {
										//实际方块，需要检查能否合并
										//处理合并
										var canMerge = checkIfDiamondValueEqual(diamond, nextDiamond);
										if(canMerge && diamond.merged == false && nextDiamond.merged == false) {
											if(diamond.row != i || diamond.colunm != j) {
												console.log(i + " " + j + "位置中的数据错误3");
											}
											console.log("将" + i + j + "并入" + nextDiamond.row + nextDiamond.colunm + ";合并value:" + diamond.value + "：" + nextDiamond.value);
											nextDiamond.value *= 2;
											//					mergeUIFresh(diamond, nextDiamond);
											nextDiamond.merged = true;

											diamond.mergeTo = true;
											delete diamondListLocal[diamond.row.toString() + diamond.colunm.toString()];
											diamond.row = diamondTemp.row;
											diamond.colunm = diamondTemp.colunm;
											diamondTempList[diamond.row.toString() + diamond.colunm.toString()] = diamond;
											return true;
										} else {
											//前方有方块，且不能合并，因为value不一致，或本方块合并过，或前方方块合并过，所以不动
										}
									} else {
										//前方方块已并入其他地方
										moveDiamondData(diamond, diamondTemp);
										console.log("前方方块已并入其他地方 不对了! 我们已经把并入其他的地方的方块都删掉了");
										return true;
									}
								} else {
									moveDiamondData(diamond, diamondTemp);
									return true;
								}
							} //滑动方向还有位置
						}
					} //当前位置存在方块
					return false;
				}

				function moveDiamondData(diamond, diamondTemp) {
					var oldRow = diamond.row;
					var oldColunm = diamond.colunm;
					diamond.row = diamondTemp.row;
					diamond.colunm = diamondTemp.colunm;
					delete diamondListLocal[oldRow.toString() + oldColunm.toString()];
					diamondListLocal[diamond.row.toString() + diamond.colunm.toString()] = diamond;
					//				moveToUIFresh(oldRow, oldColunm, diamond);
					console.log("移动" + oldRow + oldColunm + "到" + diamond.row + diamond.colunm + "；value:" + diamond.value);
				}

				function getDiamond(row, colunm, diamondListParam) {
					return diamondListParam[row.toString() + colunm.toString()];
				}

				function getDiamondWithOldPosition(row, colunm, diamondListParam) {
					for(var key in diamondListParam) {
						var diamond = diamondListParam[key];
						if(diamond.lastRow == row && diamond.lastColunm == colunm) {
							return diamond;
						}
					}
				}

				function isExistAtWithOldPosition(row, colunm, inDiamondList) {
					for(var key in inDiamondList) {
						var diamond = inDiamondList[key];
						if(diamond.lastRow == row && diamond.lastColunm == colunm) {
							return true;
						}
					}
					return false;
				}

				function checkIfDiamondValueEqual(diamond1, diamond2) {
					return diamond1.value == diamond2.value;
				}

				function tempDiamond(dirction, diamond) {
					if(dirction == SwipeDirection.SwipeLeft) {
						//colunm--
						var colunm;
						var colunmTemp = diamond.colunm - 1;
						if(colunmTemp >= 0) {
							colunm = colunmTemp;
							var tempDia = new Diamond(diamond.row, colunm, diamond.value);
							return [true, tempDia];
						} else {
							return [false];
						}

					} else if(dirction == SwipeDirection.SwipeRight) {
						var colunm;
						var colunmTemp = diamond.colunm + 1;
						if(colunmTemp <= 3) {
							colunm = colunmTemp;
							var tempDia = new Diamond(diamond.row, colunm, diamond.value);
							return [true, tempDia];
						} else {
							return [false];
						}
					} else if(dirction == SwipeDirection.SwipeDown) {
						var row;
						var rowTemp = diamond.row + 1;
						if(rowTemp <= 3) {
							row = rowTemp;
							var temDia = new Diamond(row, diamond.colunm, diamond.value);
							return [true, temDia];
						} else {
							return [false];
						}
					} else if(dirction == SwipeDirection.SwipeUp) {
						var row;
						var rowTemp = diamond.row - 1;
						if(rowTemp >= 0) {
							row = rowTemp;
							var temDia = new Diamond(row, diamond.colunm, diamond.value);
							return [true, temDia];
						} else {
							return [false];
						}
					}
				}

				function uiMove(diamond, callback) {
					var oldID = "diamond" + diamond.lastRow + diamond.lastColunm;
					var newID = "diamond" + diamond.row + diamond.colunm;
					console.log(oldID + "应该移动到" + newID);

					var topValue = $("#td" + diamond.row + diamond.colunm).offset().top;
					var leftValue = $("#td" + diamond.row + diamond.colunm).offset().left;
					$("#" + oldID).animate({
						top: topValue,
						left: leftValue
					}, 200, function() {
						callback();
					});
				}

				function uiColorRefresh(diamond) {
					var oldID = "diamond" + diamond.lastRow + diamond.lastColunm;
					var newID = "diamond" + diamond.row + diamond.colunm;

					$("#" + oldID).text(diamond.value);
					var color = diamond.color(diamond.value);
					$("#" + oldID).css("background-color", color);
					console.log(oldID + "：" + diamond.value);
					if(diamond.mergeTo) {
						//		delete diamondListLocal[diamond.row.toString() + diamond.colunm.toString()];
						$("#" + oldID).remove();
						console.log("UI移除：" + oldID);
					} else {
						$("#" + oldID).attr("id", newID);
						console.log(oldID + "变成" + newID);

						if(diamond.merged) {
							//合并动画
							flash("#" + newID, 3, 10, 50);
						}
					}
				}

				function flash(obj, time, wh, fx) {
					var x = $(obj).offset().left;
					var y = $(obj).offset().top;
					var width = $(obj).width();
					var height = $(obj).height();
					for(var i = 1; i <= time; i++) {
						if(i % 2 == 0) {
							$(obj).animate({
								left: x + wh,
								width: width - 2 * wh,
								top: y + wh,
								height: height - 2 * wh
							}, fx);
						} else {
							$(obj).animate({
								left: x,
								width: width,
								top: y,
								height: height
							}, fx);
						}
					}
				}

				function moveToUIFresh(oldRow, oldColunm, newDiamond) {
					var oldID = "diamond" + oldRow + oldColunm;
					console.log(oldID + "移动到" + newDiamond.id(newDiamond));
					var topValue = newDiamond.row * 50 + $("#table").offset().top;
					var leftValue = newDiamond.colunm * 50 + $("#table").offset().left;
					//	$("#" + oldID).offset({
					//		top: topValue,
					//		left: leftValue
					//	});
					$("#" + oldID).animate({
						top: topValue,
						left: leftValue
					});
					$("#" + oldID).text(newDiamond.value);
					$("#" + oldID).attr("id", newDiamond.id(newDiamond));
				}

				function mergeUIFresh(diamond, newDiamond) {
					var deleteID = "diamond" + diamond.row + diamond.colunm;
					$("#" + deleteID).remove();

					var newDiamondID = newDiamond.id(newDiamond);
					var color = newDiamond.color(newDiamond.value);
					console.log(deleteID + "并入" + newDiamondID + "颜色：" + color);
					$("#" + newDiamondID).css("background-color", color);
					$("#" + newDiamondID).text(newDiamond.value);
				}
			</script>

		</div>
	</body>

</html>